@model GBC_Ticketing.Models.Purchase

<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; /* remove scroll */
  }

  main {
    padding-top: 0 !important;
    margin-top: 0 !important;
  }

  footer {
    display: none !important;
  }

  /* circls middle */
  .progress-step {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 1.5rem;
  }

  .progress-circle {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.3rem;
    transition: all 0.3s ease;
  }

  .progress-circle.active {
    background-color: #4f46e5;
    color: white;
  }

  .progress-circle.inactive {
    border: 2px solid #6b7280;
    color: #9ca3af;
  }

  .progress-line {
    width: 200px;
    height: 4px;
    background-color: #6b7280;
    border-radius: 4px;
  }
</style>

<div class="d-flex flex-column justify-content-center align-items-center"
     style="height: calc(100vh - 70px); margin-top: -40px;">

  <!-- Card -->
  <div class="card bg-dark border-0 shadow-lg p-4"
       style="max-width: 640px; width: 100%; border-radius: 16px; background: rgba(25,25,35,0.9); backdrop-filter: blur(8px);">
    <div class="card-body px-5 py-3">

      <!-- Event Information -->
      @if (ViewBag.Event != null)
      {
        <div class="text-center mb-3 pb-3 border-bottom border-secondary">
          <h2 class="text-light fw-bold mb-2">@ViewBag.Event.Title</h2>
          <p class="text-primary mb-0 fs-5">
            <i class="bi bi-calendar-event me-2"></i>@ViewBag.Event.StartAt.ToString("MMMM dd, yyyy - hh:mm tt")
          </p>
        </div>
      }

      <!-- Title -->
      <h3 class="text-light text-center mb-2 fw-bold">
        Ticket Information
      </h3>
      <p class="text-secondary text-center mb-3 fs-6">
        Please enter your details to confirm your ticket.
      </p>

      <div class="d-flex justify-content-between align-items-center bg-opacity-25 bg-secondary rounded-3 px-3 py-2 mb-4"
           id="cartSummary">
        <div class="d-flex align-items-center gap-2">
          <span class="badge text-uppercase" id="cartBadge">Cart â€¢ 0</span>
          <small class="text-secondary" id="cartHintInline">Choose a quantity to begin</small>
        </div>
        <div class="text-end">
          <div class="fw-semibold text-light" id="cartTotalDisplay">Total: $0.00</div>
          <small class="text-warning" id="cartWarning"></small>
        </div>
      </div>

      <!-- FORM -->
      <form asp-action="Create" method="post" id="purchaseForm"
            data-price="@(ViewBag.Event != null ? ViewBag.Event.Price : 0)"
            data-remaining="@(ViewBag.RemainingTickets ?? 0)">
        <input type="hidden" asp-for="EventId" />

        <!-- Full Name -->
        <div class="form-group mb-2">
          <label class="form-label text-primary fw-semibold small">Full Name</label>
          <input asp-for="GuestName" class="form-control border-0 border-bottom bg-transparent text-light py-2"
                 placeholder="e.g., John Rider">
          <span asp-validation-for="GuestName" class="text-danger small"></span>
        </div>

        <!-- Email -->
        <div class="form-group mb-2">
          <label class="form-label text-primary fw-semibold small">Email Address</label>
          <input asp-for="GuestEmail" class="form-control border-0 border-bottom bg-transparent text-light py-2"
                 placeholder="e.g., example@domain.com">
          <span asp-validation-for="GuestEmail" class="text-danger small"></span>
        </div>

        <!-- Quantity -->
        <div class="form-group mb-3">
          <label class="form-label text-primary fw-semibold small">Quantity</label>
          <input asp-for="Quantity" class="form-control border-0 border-bottom bg-transparent text-light py-2"
                 id="ticketQuantity" min="1" />
          <span asp-validation-for="Quantity" class="text-danger small"></span>
          <div class="small mt-2" id="quantityHint">
            <span class="text-secondary">@((ViewBag.RemainingTickets ?? 0) > 0 ? $"Only {ViewBag.RemainingTickets} tickets left" : "Sold Out")</span>
          </div>
          <div class="small fw-semibold mt-1" id="quantityTotal"></div>
        </div>

        <!-- Button -->
        <div class="text-center mt-2">
          <button type="submit" class="btn btn-primary px-5 py-2 fw-semibold shadow-sm"
                  style="border-radius: 10px;">
            Confirm Purchase
          </button>
        </div>
      </form>

      <div class="modal fade" id="purchaseCelebrationModal" tabindex="-1"
           aria-labelledby="purchaseCelebrationLabel" aria-hidden="true"
           data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content bg-dark text-center border border-primary">
            <div class="modal-body py-5">
              <div class="display-4 mb-3">ðŸŽ‰</div>
              <h4 id="purchaseCelebrationLabel" class="text-light mb-2">Processing Purchase</h4>
              <p class="text-secondary mb-4">Hang tight while we confirm your tickets.</p>
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      @section Scripts {
        @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
      }

    </div>
  </div>
</div>
